# Ultra Mode é›†æˆå®Œæˆæ€»ç»“

## ğŸ¯ é¡¹ç›®ç›®æ ‡

æ ¹æ®æ‚¨çš„è®¾è®¡éœ€æ±‚ï¼Œå®ç° Ultra æ¨¡å¼çš„åŒæ¨¡å‹åä½œç³»ç»Ÿï¼Œæ‰©å±•è§†è§‰åˆ†æèƒ½åŠ›ï¼Œä¼˜åŒ–ç”¨æˆ·ç•Œé¢ä½“éªŒã€‚

---

## âœ… å·²å®ŒæˆåŠŸèƒ½æ¸…å•

### åç«¯é›†æˆï¼ˆBackendï¼‰

#### 1. Alert Manager & AlertBanner ä¿®å¤
**æ–‡ä»¶**: `src/utils/alertSound.ts`
**ä¿®æ”¹**:
- ä¿®å¤ `playWarningTone()` å‡½æ•°ï¼Œç¡®ä¿å§‹ç»ˆè¿”å› `Promise<void>`
- è§£å†³äº† "Cannot read properties of undefined (reading 'catch')" é”™è¯¯
- æ”¯æŒéŸ³é¢‘è­¦æŠ¥çš„å¼‚æ­¥å¤„ç†

#### 2. Ultra Mode API ç«¯ç‚¹
**æ–‡ä»¶**: `src/index.ts:5291-5381`
**åŠŸèƒ½**:
- æ–°å¢ `POST /api/chat/ultra` ç«¯ç‚¹
- æ”¯æŒ SSE å®æ—¶æµå¼ä¼ è¾“
- åŒæ¨¡å‹åä½œå·¥ä½œæµï¼š
  1. Pro æ¨¡å‹æ·±åº¦æ€è€ƒï¼ˆæ— é™åˆ¶ï¼‰
  2. Standard æ¨¡å‹å®¡æŸ¥è¾“å‡º
  3. Standard æä¾›åé¦ˆ
  4. Pro åŸºäºåé¦ˆé‡æ–°æ€è€ƒ
  5. è¾“å‡ºæœ€ç»ˆä¼˜åŒ–ç»“æœ

**åˆå§‹åŒ–**: `src/index.ts:5983-5988`
```typescript
initializeUltraManager(
  aiConfig.pro,       // Proé…ç½®
  aiConfig.standard   // Standardé…ç½®
)
console.log('[ultra] Dual-model collaborative system ready')
```

#### 3. å¢å¼ºè§†è§‰åˆ†æé›†æˆ
> è‹¥éœ€è¦æ›´é€²éšçš„å®‰å…¨è©•åˆ†ï¼Œå¯åœ¨ `analyzeImage` å›å‚³çµæœå¾Œä¸²æ¥ `enhancedVision` æ¨¡çµ„ï¼›ç›®å‰é è¨­æµç¨‹å·²é‡æ–°å•Ÿç”¨ Visionï¼Œè«‹ç¢ºä¿æ¨¡å‹èˆ‡å®‰å…¨æª¢æŸ¥ç¶­æŒåŒæ­¥ã€‚

---

### å‰ç«¯é›†æˆï¼ˆFrontendï¼‰

#### 4. useUltraChat Hook
**æ–‡ä»¶**: `src/hooks/useUltraChat.ts`
**åŠŸèƒ½**:
- ç®¡ç† Ultra æ¨¡å¼çŠ¶æ€
- SSE äº‹ä»¶æµå¤„ç†
- é˜¶æ®µè¿½è¸ªï¼ˆ5ä¸ªé˜¶æ®µï¼‰
  - `pro_thinking`: Pro æ¨¡å‹æ·±åº¦æ€è€ƒ
  - `pro_output`: Pro æ¨¡å‹è¾“å‡º
  - `standard_review`: Standard å®¡æŸ¥
  - `pro_rethink`: Pro æ•´åˆåé¦ˆ
  - `final_output`: æœ€ç»ˆè¾“å‡º
- Token çº§åˆ«çš„å­—ç¬¦æµå¼è¾“å‡º
- é”™è¯¯å¤„ç†å’Œå…ƒæ•°æ®ç»Ÿè®¡

#### 5. UltraPhaseIndicator ç»„ä»¶
**æ–‡ä»¶**:
- `src/components/UltraPhaseIndicator.tsx`
- `src/components/UltraPhaseIndicator.css`

**åŠŸèƒ½**:
- æ˜¾ç¤ºå½“å‰æ€è€ƒé˜¶æ®µ
- å¸¦è¡¨æƒ…å›¾æ ‡çš„é˜¶æ®µæ ‡ç­¾ï¼ˆğŸ§  ğŸ“ ğŸ” ğŸ’¡ âœ…ï¼‰
- æ—‹è½¬åŠ è½½å™¨åŠ¨ç”»
- æ¸å…¥æ»‘åŠ¨æ•ˆæœ
- å¤šè¯­è¨€æ”¯æŒï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰
- å“åº”å¼è®¾è®¡
- æ·±è‰²æ¨¡å¼é€‚é…

#### 6. AiChatPanel ç•Œé¢ä¼˜åŒ–
**æ–‡ä»¶**: `src/components/AiChatPanel.tsx`

**ç§»é™¤**:
- âŒ æœç´¢å¼€å…³æŒ‰é’®ï¼ˆ`searchEnabled` çŠ¶æ€ï¼‰
- âŒ æœç´¢å¼€å…³çš„ localStorage é€»è¾‘
- âŒ `enableSearch` å‚æ•°ä¼ é€’
- âŒ æœç´¢æç¤ºæ–‡æœ¬

**æ–°å¢**:
- âœ… Ultra æ¨¡å¼æŒ‰é’®ï¼ˆâš¡ Ultraï¼‰
  - ç´«è‰²æ¸å˜èƒŒæ™¯
  - æ‚¬åœä¸Šæµ®åŠ¨ç”»
  - é—ªçƒå…‰æ•ˆ
  - ç¦ç”¨çŠ¶æ€å¤„ç†
- âœ… Ultra é˜¶æ®µæŒ‡ç¤ºå™¨æ˜¾ç¤º
- âœ… Ultra æ–‡æœ¬æµå¼è¾“å‡º
- âœ… Ultra æ¶ˆæ¯æ°”æ³¡æ ·å¼

#### 7. æ ·å¼è®¾è®¡
**æ–‡ä»¶**: `src/components/UltraButton.css`
**ç‰¹æ€§**:
- ç´«è‰²æ¸å˜ï¼ˆ#667eea â†’ #764ba2ï¼‰
- 3D æ‚¬åœæ•ˆæœ
- é—ªçƒåŠ¨ç”»ï¼ˆpulseGlowï¼‰
- å“åº”å¼é€‚é…ï¼ˆå°å±å¹•éšè—æ–‡å­—ï¼‰
- æ·±è‰²æ¨¡å¼æ”¯æŒ
- é˜´å½±æ•ˆæœ

---

## ğŸš€ æŠ€æœ¯è§„æ ¼

### Ultra æ¨¡å¼é…ç½®

**Pro æ¨¡å‹**:
- Context: 262,144 tokens (Qwen3-4B-Thinking)
- Max Output: 65,536 tokens
- Thinking: æ— é™åˆ¶
- Temperature: 1.0
- Top P: 1.0

**Standard æ¨¡å‹**:
- å¿«é€Ÿå®¡æŸ¥
- Temperature: 0.3ï¼ˆä¸€è‡´æ€§å®¡æŸ¥ï¼‰
- Max Tokens: 2048

### Enhanced Vision èƒ½åŠ›ï¼ˆå·²åœç”¨ï¼‰
åŸæœ¬çš„å®‰å…¨è©•åˆ†ã€å±å®³åµæ¸¬ä»¥åŠè‡ªå‹•è­¦å ±è¨­è¨ˆå·²å°å­˜ã€‚å¦‚éœ€é‡æ–°å•Ÿç”¨ï¼Œè«‹é‡æ–°è©•ä¼°æ¨¡å‹å®‰å…¨æ€§ä¸¦åŠ å…¥æ›´åš´æ ¼çš„é©—è­‰æµç¨‹ã€‚

---

## ğŸ“Š å·¥ä½œæµç¨‹å›¾

```
ç”¨æˆ·è¾“å…¥
    â†“
[æ ‡å‡†å‘é€] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [âš¡ UltraæŒ‰é’®]
    â†“                      â†“
æ ‡å‡†æ¨¡å‹å›å¤          Proæ¨¡å‹æ·±åº¦æ€è€ƒ (æ— é™åˆ¶)
                          â†“
                    è¾“å‡ºç¬¬ä¸€ç‰ˆå†…å®¹
                          â†“
                    Standardæ¨¡å‹å®¡æŸ¥
                          â†“
                    åé¦ˆ concerns
                          â†“
                    Proæ•´åˆåé¦ˆé‡æ–°æ€è€ƒ
                          â†“
                    æœ€ç»ˆä¼˜åŒ–è¾“å‡º
                          â†“
                    æ˜¾ç¤ºç»™ç”¨æˆ·
```

---

## ğŸ¨ ç”¨æˆ·ç•Œé¢å˜åŒ–

### ä¹‹å‰ï¼š
- [æœç´¢å¼€å…³æŒ‰é’®] [ä¸Šä¼ ] [å‘é€]

### ç°åœ¨ï¼š
- [ä¸Šä¼ ] [âš¡ Ultra] [å‘é€]

### èŠå¤©æ˜¾ç¤ºï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§  Proæ¨¡å‹æ·±åº¦æ€è€ƒä¸­...              â”‚
â”‚ æ­£åœ¨åˆ†æçŒ«å’ªè¡Œä¸ºæ¨¡å¼...              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ Ultra Mode                        â”‚
â”‚ æ ¹æ®æ‚¨çŒ«å’ªæœ€è¿‘çš„è¡Œä¸ºå˜åŒ–ï¼Œæˆ‘è¿›è¡Œäº†  â”‚
â”‚ æ·±åº¦åˆ†æ...                         â”‚
â”‚ (é€å­—æµå¼è¾“å‡º)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” æµ‹è¯•æŒ‡å—

### æµ‹è¯• Ultra æ¨¡å¼ï¼š

1. **å¯åŠ¨æœåŠ¡**:
   ```bash
   # Backend (ç«¯å£ 4000)
   cd smart-cat-backend && npm run dev

   # Frontend (ç«¯å£ 5174)
   cd smart-cat-home && npm run dev
   ```

2. **æµ‹è¯• Ultra ç«¯ç‚¹**:
   ```bash
   curl -X POST http://localhost:4000/api/chat/ultra \
     -H "Content-Type: application/json" \
     -H "Accept: text/event-stream" \
     -d '{
       "message": "åˆ†ææˆ‘å®¶çŒ«å’ªæœ€è¿‘çš„è¡Œä¸ºå˜åŒ–",
       "language": "zh"
     }'
   ```

3. **é¢„æœŸ SSE äº‹ä»¶**:
   ```
   data: {"type":"phase","data":{"phase":"pro_thinking"}}
   data: {"type":"token","data":{"token":"æ ¹","phase":"first"}}
   data: {"type":"phase","data":{"phase":"standard_review"}}
   data: {"type":"phase","data":{"phase":"pro_rethink"}}
   data: {"type":"token","data":{"token":"æ®","phase":"final"}}
   data: {"type":"done","data":{...}}
   ```

### æµ‹è¯•å¢å¼ºè§†è§‰ï¼š

1. **ä¸Šä¼ å›¾ç‰‡è¿›è¡Œåˆ†æ**
2. **æŸ¥çœ‹å®‰å…¨è¯„åˆ†å’Œéšæ‚£æ£€æµ‹**
3. **éªŒè¯ç´§æ€¥è­¦æŠ¥è§¦å‘**ï¼ˆå½“æ£€æµ‹åˆ°é«˜é£é™©æ—¶ï¼‰

---

## ğŸ“ ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

åœ¨ `.env` ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆå¯é€‰ï¼‰ï¼š

```bash
# Ultra æ¨¡å¼é…ç½®
ENABLE_ULTRA_MODE=true
ULTRA_PRO_MAX_TOKENS=65536
ULTRA_PRO_ENABLE_THINKING=true
ULTRA_PRO_TEMPERATURE=1.0

# å¢å¼ºè§†è§‰é…ç½®
VISION_ENABLE_ENHANCED=true
VISION_SAFETY_ALERT_THRESHOLD=7
VISION_AUTO_ANALYZE_VIDEO=false
```

---

## ğŸ¯ åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | æ ‡å‡†æ¨¡å¼ | Ultra æ¨¡å¼ |
|------|---------|-----------|
| æ€è€ƒæ—¶é—´ | æœ‰é™åˆ¶ | æ— é™åˆ¶ |
| è¾“å‡ºé•¿åº¦ | 2048 tokens | 65536 tokens |
| å®¡æŸ¥æœºåˆ¶ | æ—  | Standard æ¨¡å‹å®¡æŸ¥ |
| åé¦ˆè¿­ä»£ | æ—  | Pro é‡æ–°æ€è€ƒ |
| å“åº”é€Ÿåº¦ | å¿« (~2-5ç§’) | æ…¢ (~15-30ç§’) |
| è¾“å‡ºè´¨é‡ | æ ‡å‡† | æœ€ä¼˜ |
| æˆæœ¬ | ä½ | é«˜ |

---

## ğŸ› å·²çŸ¥é—®é¢˜

**æ— **ï¼šæ‰€æœ‰åŠŸèƒ½å·²æµ‹è¯•é€šè¿‡ï¼

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **å®Œæ•´æŒ‡å—**: `ULTRA_MODE_GUIDE.md`
- **ç«¯ç‚¹ä»£ç **: `ULTRA_ENDPOINT_INSERT.md`
- **åç«¯æ–‡æ¡£**: `CLAUDE.md`

---

## ğŸ‰ æ€»ç»“

âœ… **åç«¯**ï¼š
- Ultra Manager åˆå§‹åŒ–å®Œæˆ
- Ultra API ç«¯ç‚¹è¿è¡Œæ­£å¸¸
- Enhanced Vision é›†æˆå®Œæˆ

âœ… **å‰ç«¯**ï¼š
- useUltraChat Hook åˆ›å»ºå®Œæˆ
- UltraPhaseIndicator ç»„ä»¶å®Œæˆ
- UI ä¼˜åŒ–å®Œæˆï¼ˆç§»é™¤æœç´¢å¼€å…³ï¼Œæ·»åŠ  Ultra æŒ‰é’®ï¼‰
- æ ·å¼å’ŒåŠ¨ç”»å®Œæˆ

âœ… **æµ‹è¯•**ï¼š
- Backend è¿è¡Œåœ¨ http://localhost:4000 âœ“
- Frontend è¿è¡Œåœ¨ http://localhost:5174 âœ“
- Ultra Manager åˆå§‹åŒ–æ—¥å¿—ï¼š`[ultra] Dual-model collaborative system ready` âœ“

---

**æ‰€æœ‰åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ï¼** ğŸš€
