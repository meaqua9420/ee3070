# Smart Cat Pro v2 æ•°æ®é›† - å¿«é€Ÿä½¿ç”¨æŒ‡å—

## ğŸ“Š æ•°æ®é›†æ¦‚è§ˆ

**ç‰ˆæœ¬**: v2.0
**ç”Ÿæˆæ—¥æœŸ**: 2025-01-04
**æ€»æ ·æœ¬æ•°**: 306
**è´¨é‡éªŒè¯**: âœ… 100% é€šè¿‡

### æ•°æ®åˆ†å¸ƒ
- **è®­ç»ƒé›†** (`train.jsonl`): 244 æ ·æœ¬ (80%)
- **éªŒè¯é›†** (`valid.jsonl`): 30 æ ·æœ¬ (10%)
- **æµ‹è¯•é›†** (`test.jsonl`): 32 æ ·æœ¬ (10%)

### åœºæ™¯è¦†ç›–
1. **ç¯å¢ƒç›‘æ§** (102 æ ·æœ¬): æ¹¿åº¦/æ¸©åº¦å¼‚å¸¸å¤„ç†
2. **å¥åº·è¿½è¸ª** (102 æ ·æœ¬): é¥®æ°´/ä½“é‡ç›‘æµ‹åˆ†æ
3. **è¡Œä¸ºåˆ†æ** (51 æ ·æœ¬): çŒ«å’ªå†²çªè¡Œä¸ºç®¡ç†
4. **é¢„é˜²æ€§ç»´æŠ¤** (51 æ ·æœ¬): ä¼ æ„Ÿå™¨æ ¡å‡†è¯Šæ–­

---

## ğŸ¯ å…³é”®æ”¹è¿› (ç›¸æ¯” v1)

### âŒ V1 çš„é—®é¢˜
- Thinking å†…å®¹æ¨¡æ¿åŒ–ï¼Œç¼ºä¹çœŸå®æ¨ç†
- æ¨¡å‹è™šæ„ä¼ æ„Ÿå™¨æ•°æ®ï¼ˆå¹»è§‰ä¸¥é‡ï¼‰
- æ•°æ®è§„æ¨¡ä¸è¶³ (558 æ ·æœ¬)
- æ— æ³•å±•ç¤º "Full chain-of-thought"

### âœ… V2 çš„è§£å†³æ–¹æ¡ˆ
- **é«˜è´¨é‡ Thinking**: æ¯ä¸ªæ ·æœ¬åŒ…å«å®Œæ•´çš„æ¨ç†é“¾æ¡ (300-1200 å­—ç¬¦)
- **çœŸå®æ•°æ®è¾“å…¥**: System message åŒ…å«å®Œæ•´çš„ä¼ æ„Ÿå™¨å¿«ç…§
- **æ•°æ®çœŸå®æ€§**: Assistant çš„æ•°å€¼å¼•ç”¨åŸºäº system æä¾›çš„æ•°æ®
- **å¤šæ ·æ€§**: ä¸åŒæ•°å€¼èŒƒå›´ã€çŒ«å’ªåå­—ã€æ—¶é—´æ®µã€ä¸¥é‡ç¨‹åº¦

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. æŸ¥çœ‹æ ·æœ¬ç¤ºä¾‹

```bash
# æŸ¥çœ‹è®­ç»ƒé›†ç¬¬ä¸€ä¸ªæ ·æœ¬ (æ ¼å¼åŒ–è¾“å‡º)
head -n 1 datasets/pro-finetune-v2/train.jsonl | jq

# æŸ¥çœ‹æ ·æœ¬çš„ thinking å†…å®¹
head -n 1 datasets/pro-finetune-v2/train.jsonl | jq '.messages[2].thinking'
```

### 2. éªŒè¯æ•°æ®è´¨é‡

```bash
# è¿è¡Œè´¨é‡éªŒè¯è„šæœ¬
node scripts/validate-dataset-v2.mjs

# é¢„æœŸè¾“å‡º: âœ… All samples meet quality standards!
```

### 3. ä½¿ç”¨ MLX è®­ç»ƒ

```bash
# æ–¹æ³• 1: ä½¿ç”¨ mlx_lm.lora (æ¨è)
mlx_lm.lora \
  --model NexaAIDev/Qwen2.5-Coder-7B-Instruct \
  --train \
  --data datasets/pro-finetune-v2 \
  --iters 1000 \
  --learning-rate 1e-5 \
  --batch-size 2 \
  --adapter-path adapters/smart-cat-pro-v2

# æ–¹æ³• 2: ä½¿ç”¨ Nexa CLI
nexa finetune create \
  --model Qwen2.5-Coder-7B-Instruct \
  --train-file datasets/pro-finetune-v2/train.jsonl \
  --validation-file datasets/pro-finetune-v2/valid.jsonl \
  --epochs 3 \
  --lr 1e-5 \
  --batch-size 2 \
  --suffix smart-cat-pro-v2
```

### 4. æ›´æ–°åç«¯é…ç½®

è®­ç»ƒå®Œæˆåï¼Œæ›´æ–° `.env`:

```env
LOCAL_LLM_PRO_MODEL_ID=smart-cat-pro-v2
LOCAL_LLM_PRO_ENABLE_THINKING=true
DEVELOPER_THINKING_PROMPT_ENABLED=true
```

é‡å¯åç«¯ï¼š

```bash
npm start
```

### 5. æµ‹è¯•æ¨¡å‹

```bash
# ä½¿ç”¨ smoke test
npm run chat:smoke

# æˆ–ç›´æ¥è°ƒç”¨ API
curl -X POST http://localhost:4000/api/chat/suggestions \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ç±³é¦™ä»Šå¤©å–æ°´åªæœ‰ 136 mlï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ",
    "language": "zh"
  }'
```

---

## ğŸ“ Thinking è´¨é‡æ ‡å‡†

æ¯ä¸ªæ ·æœ¬çš„ thinking å¿…é¡»åŒ…å«ï¼š

1. **æ•°æ®åˆ†æä¸éªŒè¯**: æ£€æŸ¥ä¼ æ„Ÿå™¨æ•°æ®çš„å‡†ç¡®æ€§
2. **é—®é¢˜ç†è§£**: ç”¨æˆ·çœŸæ­£å…³å¿ƒä»€ä¹ˆï¼Ÿ
3. **æ¨ç†æ­¥éª¤**: ä»æ•°æ®åˆ°ç»“è®ºçš„å®Œæ•´é“¾æ¡
4. **æ–¹æ¡ˆæ¯”è¾ƒ**: å¤šä¸ªæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ (å¤æ‚åœºæ™¯)
5. **é£é™©è¯„ä¼°**: æ½œåœ¨é—®é¢˜å’Œç¼“è§£æªæ–½
6. **åç»­è¡ŒåŠ¨**: ç›‘æ§ç‚¹å’ŒéªŒè¯æ–¹æ³•

### ç¤ºä¾‹ Thinking ç»“æ„

```
<think>
1. æ•°æ®åˆ†æä¸éªŒè¯ï¼š
   - æ£€æŸ¥å†å²æ•°æ®ï¼š5å°æ—¶å†…æ¹¿åº¦ä» 73.3% ä¸Šå‡è‡³ 76.2%
   - è®¡ç®—å¹³å‡å€¼ï¼š75.0%
   - ä¸ç›®æ ‡å¯¹æ¯”ï¼šè¶…æ ‡ 15 ä¸ªç™¾åˆ†ç‚¹

2. é—®é¢˜æ ¹æºåˆ†æï¼š
   - è‡ªåŠ¨é™¤æ¹¿ç³»ç»Ÿæœªè§¦å‘
   - æ¹¿åº¦å‘ˆç¼“æ…¢ä¸Šå‡è¶‹åŠ¿

3. è§£å†³æ–¹æ¡ˆè¯„ä¼°ï¼š
   æ–¹æ¡ˆA: ç«‹å³å¼ºåŠ›é™¤æ¹¿
   - ä¼˜ç‚¹: å¿«é€Ÿ
   - ç¼ºç‚¹: è€—èƒ½é«˜

   æ–¹æ¡ˆB: å¾ªç¯æ‰‡ + æ¸©å’Œé™¤æ¹¿ (æ¨è)
   - ä¼˜ç‚¹: å¹³è¡¡æ•ˆæœ
   - ç¼ºç‚¹: æ•ˆæœè¾ƒæ…¢

4. å†³ç­–: é€‰æ‹©æ–¹æ¡ˆB + é˜¶æ®µæ€§å‡çº§æœºåˆ¶

5. é£é™©è¯„ä¼°ä¸ç›‘æ§ç‚¹ï¼š
   - 45åˆ†é’Ÿåæ£€æŸ¥æ¹¿åº¦
   - ç›‘æ§çŒ«å’ªä½ç½®
</think>
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜: æ¨¡å‹ä»ç„¶äº§ç”Ÿå¹»è§‰

**å¯èƒ½åŸå› **:
1. è®­ç»ƒ epochs ä¸è¶³ (å»ºè®® 3-5 epochs)
2. Learning rate è¿‡é«˜ (å»ºè®® 1e-5 åˆ° 5e-6)
3. æ—§æ¨¡å‹ç¼“å­˜æœªæ¸…ç†

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…ç†æ—§æ¨¡å‹ç¼“å­˜
rm -rf ~/.cache/huggingface/hub/models--NexaAIDev*

# é‡æ–°è®­ç»ƒï¼Œå¢åŠ  epochs
mlx_lm.lora --epochs 5 --learning-rate 5e-6 ...
```

### é—®é¢˜: Thinking ä»ç„¶æ¨¡æ¿åŒ–

**å¯èƒ½åŸå› **:
ç³»ç»Ÿ prompt çš„å½±å“å¤§äºè®­ç»ƒæ•°æ®

**è§£å†³æ–¹æ¡ˆ**:
åœ¨ `src/ai.ts` ä¸­å¯ç”¨ developer mode:
```typescript
const DEVELOPER_THINKING_PROMPT_ENABLED = true
```

### é—®é¢˜: è®­ç»ƒé€Ÿåº¦å¤ªæ…¢

**ä¼˜åŒ–å»ºè®®**:
1. å‡å°‘ `variantsPerTemplate` (å½“å‰ 50 â†’ æ”¹ä¸º 30)
2. ä½¿ç”¨æ›´å°çš„æ¨¡å‹ (Qwen2.5-3B instead of 7B)
3. å¯ç”¨ GPU åŠ é€Ÿ

---

## ğŸ“ˆ é¢„æœŸè®­ç»ƒæ•ˆæœ

### è®­ç»ƒå‰ (V1 æ¨¡å‹)
- âŒ Thinking å†…å®¹: "å›é¡¾æé—®... å…ˆå¿«é€Ÿæ•´ç†..."
- âŒ æ•°æ®æ¥æº: è™šæ„æ•°å€¼
- âŒ æ¨ç†è´¨é‡: æ— å®è´¨å†…å®¹

### è®­ç»ƒå (V2 æ¨¡å‹)
- âœ… Thinking å†…å®¹: å®Œæ•´çš„æ•°æ®åˆ†æå’Œæ¨ç†é“¾
- âœ… æ•°æ®æ¥æº: å¼•ç”¨ system æä¾›çš„çœŸå®æ•°æ®
- âœ… æ¨ç†è´¨é‡: å¤šæ­¥éª¤ã€æœ‰ä¾æ®ã€å¯éªŒè¯

---

## ğŸ’¡ è¿›ä¸€æ­¥æ”¹è¿›å»ºè®®

### å¦‚æœéœ€è¦æ›´å¤§è§„æ¨¡æ•°æ®é›†

ç¼–è¾‘ `scripts/generate-dataset-v2.mjs`:

```javascript
const CONFIG = {
  variantsPerTemplate: 80,  // 50 â†’ 80
  targetTotal: 600,         // 400 â†’ 600
}
```

ç„¶åé‡æ–°ç”Ÿæˆ:

```bash
node scripts/generate-dataset-v2.mjs
```

### æ·»åŠ æ–°åœºæ™¯ç±»å‹

1. åœ¨ `datasets/pro-finetune-v2/templates/` åˆ›å»ºæ–°æ¨¡æ¿æ–‡ä»¶
2. æŒ‰ç…§ç°æœ‰æ ¼å¼ç¼–å†™é»„é‡‘æ ·æœ¬
3. é‡æ–°è¿è¡Œç”Ÿæˆè„šæœ¬

---

## ğŸ“ æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿæ£€æŸ¥ä»¥ä¸‹èµ„æºï¼š

1. **æ•°æ®é›† README**: `datasets/pro-finetune-v2/README.md`
2. **åç«¯æ–‡æ¡£**: `CLAUDE.md`
3. **Pro æ¨¡å‹æ–‡æ¡£**: [Hugging Face - GPT-OSS](https://huggingface.co/gpt-oss)

---

## âœ… æ£€æŸ¥æ¸…å•

ä½¿ç”¨å‰è¯·ç¡®è®¤ï¼š

- [ ] è¿è¡Œ `node scripts/validate-dataset-v2.mjs` é€šè¿‡
- [ ] æŸ¥çœ‹è‡³å°‘ 5 ä¸ªæ ·æœ¬çš„ thinking è´¨é‡
- [ ] ç¡®è®¤è®­ç»ƒç¯å¢ƒå·²é…ç½® (MLX / Nexa)
- [ ] å¤‡ä»½å½“å‰æ¨¡å‹ (å¦‚æœæœ‰)
- [ ] æ›´æ–° `.env` é…ç½®

**å‡†å¤‡å°±ç»ªï¼å¼€å§‹è®­ç»ƒå§ï¼** ğŸš€
